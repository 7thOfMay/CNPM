<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Dashboard - TutorPro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <nav class="navbar">
                <div class="logo">
                    <h1>TutorPro <span style="font-size: 0.8em; opacity: 0.8;">Tutor</span></h1>
                </div>
                <div class="nav-links">
                    <a href="#dashboard" class="active" onclick="showTab('dashboard')">Dashboard</a>
                    <a href="#courses" onclick="showTab('courses')">My Courses</a>
                    <a href="#sessions" onclick="showTab('sessions')">Sessions</a>
                    <a href="#resources" onclick="showTab('resources')">Resources</a>
                    <a href="#chat" id="chatLink">Messages <span id="unreadBadge" class="badge hidden">0</span></a>
                    <a href="#notifications" id="notificationsLink">Notifications <span id="notificationBadge" class="badge hidden">0</span></a>
                    <button id="logoutBtn" class="btn btn-small">Logout</button>
                </div>
            </nav>
        </header>

        <main style="padding: 2rem;">
            <div class="welcome-section">
                <h3 id="tutorWelcome">Welcome back!</h3>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content">
                <div class="dashboard-section">
                    <h3>Course Progress Overview</h3>
                    <div id="tutorProgressView"></div>
                </div>
            </div>

            <!-- Courses Tab -->
            <div id="tab-courses" class="tab-content hidden">
                <div class="dashboard-section">
                    <h3>Create New Course</h3>
                    <form id="createCourseForm" class="form">
                        <div class="form-group">
                            <label for="courseTitle">Course Title</label>
                            <input type="text" id="courseTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="courseSubject">Subject</label>
                            <select id="courseSubject" required>
                                <option value="math">Mathematics</option>
                                <option value="science">Science</option>
                                <option value="programming">Programming</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="courseLevel">Level</label>
                            <select id="courseLevel" required>
                                <option value="beginner">Beginner</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="advanced">Advanced</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Course</button>
                    </form>
                    <div id="createCourseMessage" class="message"></div>
                </div>
                <div class="dashboard-section">
                    <h3>My Courses</h3>
                    <div id="tutorCoursesList"></div>
                </div>
            </div>

            <!-- Sessions Tab -->
            <div id="tab-sessions" class="tab-content hidden">
                <div class="dashboard-section">
                    <h3>Create Session</h3>
                    <form id="createSessionForm" class="form">
                        <div class="form-group">
                            <label for="sessionCourse">Course</label>
                            <select id="sessionCourse" required></select>
                        </div>
                        <div class="form-group">
                            <label for="sessionDate">Date</label>
                            <input type="date" id="sessionDate" required>
                        </div>
                        <div class="form-group">
                            <label for="sessionStartTime">Start Time</label>
                            <input type="time" id="sessionStartTime" required>
                        </div>
                        <div class="form-group">
                            <label for="sessionEndTime">End Time</label>
                            <input type="time" id="sessionEndTime" required>
                        </div>
                        <div class="form-group">
                            <label for="sessionMaxStudents">Max Students</label>
                            <input type="number" id="sessionMaxStudents" value="10" min="1" max="50">
                        </div>
                        <div class="form-group">
                            <label for="sessionLocation">Location</label>
                            <input type="text" id="sessionLocation" placeholder="Online or physical address">
                        </div>
                        <div class="form-group">
                            <label for="sessionDescription">Description</label>
                            <textarea id="sessionDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Session</button>
                    </form>
                    <div id="createSessionMessage" class="message"></div>
                </div>
                <div class="dashboard-section">
                    <h3>My Sessions</h3>
                    <div id="tutorSessionsList"></div>
                </div>
            </div>

            <!-- Resources Tab -->
            <div id="tab-resources" class="tab-content hidden">
                <div class="dashboard-section">
                    <h3>Learning Resources</h3>
                    <form id="createResourceForm" class="form" style="margin-bottom: 2rem;">
                        <div class="form-group">
                            <label for="resourceCourse">Course (Optional - leave blank for public)</label>
                            <select id="resourceCourse"></select>
                        </div>
                        <div class="form-group">
                            <label for="resourceTitle">Title</label>
                            <input type="text" id="resourceTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="resourceType">Type</label>
                            <select id="resourceType" required>
                                <option value="pdf">PDF Document</option>
                                <option value="video">Video</option>
                                <option value="link">External Link</option>
                                <option value="document">Document</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="resourceFile">Upload File</label>
                            <input type="file" id="resourceFile" required>
                        </div>
                        <div class="form-group">
                            <label for="resourceDescription">Description</label>
                            <textarea id="resourceDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Resource</button>
                    </form>
                    <div id="createResourceMessage" class="message"></div>
                    <div id="tutorResourcesList" class="resource-list"></div>
                </div>
            </div>

            <!-- Chat Section -->
            <section id="chat" class="section hidden">
                <h2>Messages</h2>
                <div class="chat-container-main">
                    <div class="chat-sidebar">
                        <h3>Conversations</h3>
                        <div class="chat-user-search">
                            <input type="text" id="userSearch" placeholder="Search users...">
                            <button id="newChatBtn" class="btn btn-primary">New Chat</button>
                        </div>
                        <div id="chatRoomsList" class="chat-rooms-list"></div>
                    </div>
                    <div class="chat-main">
                        <div id="chatHeader" class="chat-header">
                            <p>Select a conversation to start messaging</p>
                        </div>
                        <div id="chatMessagesArea" class="chat-messages-area"></div>
                        <div id="chatInputArea" class="chat-input-area hidden">
                            <form id="chatMessageForm">
                                <input type="text" id="chatMessageInput" placeholder="Type a message..." required>
                                <button type="submit" class="btn btn-primary">Send</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- New Chat Modal -->
                <div id="newChatModal" class="modal hidden">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3>Start New Conversation</h3>
                        <div id="availableUsersList" class="users-list-modal"></div>
                    </div>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications" class="section hidden">
                <h2>Notifications</h2>
                <div class="dashboard-section">
                    <button class="btn btn-secondary" onclick="markAllNotificationsRead()">Mark All as Read</button>
                    <div id="notificationsList" style="margin-top: 1rem;"></div>
                </div>
            </section>

        </main>
    </div>

    <script src="app.js?v=2"></script>
    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.section').forEach(sec => sec.classList.add('hidden'));
            
            const selectedTab = document.getElementById(`tab-${tabName}`);
            if (selectedTab) {
                selectedTab.classList.remove('hidden');
            } else {
                const section = document.getElementById(tabName);
                if (section) section.classList.remove('hidden');
            }

            document.querySelectorAll('.nav-links a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${tabName}`) {
                    link.classList.add('active');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user || user.role !== 'tutor') {
                window.location.href = 'login.html';
                return;
            }
            
            const welcomeEl = document.getElementById('tutorWelcome');
            if (welcomeEl) welcomeEl.textContent = `Welcome back, ${user.username}!`;

            loadTutorDashboard();
        });
    </script>
</body>
</html>
